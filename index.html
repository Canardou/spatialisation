<html>
    <head>
        
    </head>
    <body>
        <video controls loop id="file">
            <source src=IRIT01.webm type=video/webm>
        </video>
        <p><canvas id="canvas"></canvas></p>
        <script type="text/javascript">
        "use strict";
        var file = document.getElementById('file');
        var canvas = document.getElementById('canvas');
        var videoStream = null;
        var preLog = document.getElementById('preLog');
        
        function log(text)
        {
        	if (preLog) preLog.textContent += ('\n' + text);
        	else alert(text);
        }
        
        var imageDataCurr;
        var imageDataOld;
        function snapshot()
        {
        	canvas.width = file.videoWidth;
        	canvas.height = file.videoHeight;
        	
        	canvas.getContext('2d').drawImage(file, 0, 0);
        	try{
            	var imageData = canvas.getContext('2d').getImageData(0, 0, canvas.width, canvas.height);
            	imageDataCurr = canvas.getContext('2d').getImageData(0, 0, canvas.width, canvas.height);
            	
                var pixels = imageData.data;
                
                for(var i = 0, il = pixels.length; i < il; i++) {
                    pixels[i] = Math.abs(pixels[i] - imageDataOld.data[i])*255;
                }
                
        	    canvas.getContext('2d').putImageData(imageData, 0, 0);
        	}
        	catch (e){
        	    console.log("Error")
        	}
            imageDataOld = imageDataCurr;
            window.requestAnimationFrame(snapshot);
        }
        
        window.requestAnimationFrame(snapshot);
        
        
        // crÃ©e un contexteaudio
        var contexteAudio = new (window.AudioContext || window.webkitAudioContext)();
        
        // create Oscillator node
        var oscillator = contexteAudio.createOscillator();
        oscillator.type = 'square';
        oscillator.frequency.setValueAtTime(440, 0); // valeur en hertz
        oscillator.detune.setValueAtTime(0.2, 0);

        var gainNode = contexteAudio.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(contexteAudio.destination);
        gainNode.gain.setValueAtTime(0.1, contexteAudio.currentTime);
        
        //oscillator.start();
        oscillator.stop(contexteAudio.currentTime + 2);
        </script>
    </body>
</html>